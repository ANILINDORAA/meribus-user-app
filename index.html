<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Meri Bus - By Anil Indora</title>
    
    <style>
        /* --- START OF CSS --- */
        html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5; display: flex; justify-content: center; align-items: center; user-select: none;
        }
        .app-container {
            width: 100%; height: 100%; /* <<-- ‡§∏‡•Å‡§ß‡§æ‡§∞ 1: ‡§™‡•Ç‡§∞‡•Ä ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§ï‡§µ‡§∞ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è */
            max-width: 450px; /* ‡§¨‡•ú‡•Ä ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§™‡§∞ ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§¶‡§ø‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è */
            background-color: #ffffff;
            overflow: hidden; position: relative;
            display: flex; flex-direction: column;
        }
        .screen {
            padding: 20px; height: 100%; display: none; flex-direction: column; box-sizing: border-box; 
            animation: fadeIn 0.4s; overflow-y: auto;
        }
        .screen.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .header { text-align: center; margin-bottom: 30px; flex-shrink: 0; }
        .header h1 { font-size: 24px; color: #333; margin: 0; }
        .sub-header { color: #555; margin-top: 5px; }
        .content-body { flex-grow: 1; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #555; }
        select, input[type="text"] { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ddd; font-size: 16px; box-sizing: border-box; }
        .btn { width: 100%; padding: 15px; background: linear-gradient(45deg, #4CAF50, #81C784); color: white; border: none; border-radius: 8px; font-size: 18px; cursor: pointer; margin-top: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .language-options { display: flex; justify-content: center; margin: 20px 0; }
        .lang-btn { flex: 1; padding: 15px; font-size: 18px; border: 2px solid #ddd; background-color: #f9f9f9; cursor: pointer; }
        .lang-btn:first-child { border-radius: 10px 0 0 10px; border-right: none; }
        .lang-btn:last-child { border-radius: 0 10px 10px 0; }
        .lang-btn.active { border-color: #4CAF50; background-color: #e8f5e9; font-weight: bold; color: #4CAF50; }
        .app-logo { width: 80px; height: 80px; border-radius: 20px; margin-bottom: 15px; }
        .owner-name { text-align: center; font-size: 14px; color: #888; padding: 20px; flex-shrink: 0; }
        .route-item { background-color: #f9f9f9; padding: 15px; border-radius: 8px; margin-bottom: 10px; cursor: pointer; border-left: 5px solid #4CAF50; }
        .route-name { font-weight: bold; font-size: 18px; }
        .route-time { color: #555; font-size: 14px; margin-top: 5px; }

        /* ‡§Æ‡•à‡§™ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§∏‡•ç‡§ü‡§æ‡§á‡§≤‡§ø‡§Ç‡§ó */
        #map-screen { padding: 0; }
        .map-header { padding: 15px; background-color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); position: absolute; top: 0; left: 0; width: 100%; z-index: 20; box-sizing: border-box; display: flex; align-items: center; }
        .map-header .back-arrow { font-size: 24px; font-weight: bold; cursor: pointer; padding-right: 15px; }
        .map-header h1 { font-size: 18px; margin: 0; }
        .map-container { flex-grow: 1; position: relative; background-color: #ffffff; display: flex; align-items: center; padding-top: 60px; }
        #route-line { position: absolute; width: 6px; height: 76%; background: #d0e1ff; left: 50%; top: 12%; border-radius: 3px; transform: translateX(-50%); }
        .bus-icon { position: absolute; font-size: 30px; left: 50%; top: 12%; transition: top 2s linear; text-shadow: 0 2px 4px rgba(0,0,0,0.4); z-index: 10; transform: translateX(-50%); }
        .stop { position: absolute; font-size: 10px; left: 50%; width: 12px; height: 12px; background-color: white; border: 3px solid #4285F4; border-radius: 50%; transform: translateX(-50%); z-index: 5; }
        .stop-label { font-size: 12px; font-weight: bold; background: white; padding: 3px 6px; border-radius: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.3); position: absolute; left: 20px; top: -5px; white-space: nowrap; color: #333; }
        #stop1 { top: 12%; } #stop2 { top: 25%; } #stop3 { top: 38%; } #stop4 { top: 50%; } #stop5 { top: 62%; } #stop6 { top: 75%; } #stop7 { top: 88%; }
        /* --- END OF CSS --- */
    </style>
</head>
<body>
    <div class="app-container">

        <!-- ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® 0: ‡§≠‡§æ‡§∑‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç -->
        <div id="language-screen" class="screen">
            <div class="content-body">
                <div class="header">
                    <img src="data:image/png;base64,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" alt="Meri Bus Logo" class="app-logo"> 
                <h1 data-key="welcome_title">Meri Bus ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à</h1>
            </div>
            <div class="content-body">
                <div class="language-options">
                    <button class="lang-btn" data-lang="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</button>
                    <button class="lang-btn" data-lang="en">English</button>
                </div>
            </div>
            <p class="owner-name">Owner: Anil Indora</p>
        </div>
        
        <!-- ‡§∏‡•Å‡§ß‡§æ‡§∞ 3: ‡§è‡§ï ‡§π‡•Ä ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§™‡§∞ ‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§∏‡•á‡§ü‡§Ö‡§™ -->
        <div id="location-setup-screen" class="screen">
            <div class="content-body">
                <div class="header"><h1 data-key="location_setup_title">‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç</h1></div>
                <div class="form-group">
                    <label for="state" data-key="state">‡§∞‡§æ‡§ú‡•ç‡§Ø</label>
                    <select id="state"><option value="Rajasthan" data-key="rajasthan_option">‡§∞‡§æ‡§ú‡§∏‡•ç‡§•‡§æ‡§®</option></select>
                </div>
                <div class="form-group">
                    <label for="district" data-key="district">‡§ú‡§º‡§ø‡§≤‡§æ</label>
                    <select id="district"><option value="Sri Ganganagar" data-key="ganganagar_option">‡§∂‡•ç‡§∞‡•Ä ‡§ó‡§Ç‡§ó‡§æ‡§®‡§ó‡§∞</option></select>
                </div>
                <div class="form-group">
                    <label for="tehsil" data-key="tehsil">‡§§‡§π‡§∏‡•Ä‡§≤</label>
                    <select id="tehsil"><option value="Anupgarh" data-key="anupgarh_option">‡§Ö‡§®‡•Ç‡§™‡§ó‡§¢‡§º</option></select>
                </div>
                <button class="btn" id="save-location-btn" data-key="save_and_continue">‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§Ü‡§ó‡•á ‡§¨‡§¢‡§º‡•á‡§Ç</button>
            </div>
        </div>

        <!-- ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® 2: ‡§¨‡§∏ ‡§∏‡§∞‡•ç‡§ö -->
        <div id="search-screen" class="screen">
            <div class="header"><h1 data-key="find_bus_title">‡§¨‡§∏ ‡§ñ‡•ã‡§ú‡•á‡§Ç</h1></div>
            <div class="content-body">
                <div class="form-group">
                    <label for="from-stop" data-key="from">‡§ï‡§π‡§æ‡§Å ‡§∏‡•á</label>
                    <input type="text" id="from-stop" data-placeholder-key="from_placeholder" value="‡§Ö‡§®‡•Ç‡§™‡§ó‡§¢‡§º">
                </div>
                <div class="form-group">
                    <label for="to-stop" data-key="to">‡§ï‡§π‡§æ‡§Å ‡§§‡§ï</label>
                    <input type="text" id="to-stop" data-placeholder-key="to_placeholder" value="‡§®‡§∞‡§µ‡§æ‡§≤‡•Ä">
                </div>
            </div>
            <button class="btn" id="find-buses-btn" data-key="find_buses_btn">‡§¨‡§∏‡•á‡§Ç ‡§ñ‡•ã‡§ú‡•á‡§Ç</button>
        </div>

        <!-- ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® 3: ‡§∞‡•Ç‡§ü ‡§ï‡•Ä ‡§≤‡§ø‡§∏‡•ç‡§ü -->
        <div id="route-list-screen" class="screen">
            <div class="header">
                <h1>‡§Ö‡§®‡•Ç‡§™‡§ó‡§¢‡§º ‚Üî ‡§®‡§∞‡§µ‡§æ‡§≤‡•Ä</h1>
                <p class="sub-header" data-key="available_routes">‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§∞‡•Ç‡§ü</p>
            </div>
            <div class="content-body">
                <div class="route-item" onclick="selectRouteAndShowMap('route_anp_nrw')">
                    <div class="route-name">‡§Ö‡§®‡•Ç‡§™‡§ó‡§¢‡§º ‚Üí ‡§®‡§∞‡§µ‡§æ‡§≤‡•Ä</div>
                    <div class="route-time" data-key="live_tracking_available">‡§≤‡§æ‡§á‡§µ ‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó ‡§â‡§™‡§≤‡§¨‡•ç‡§ß</div>
                </div>
                <div class="route-item" onclick="selectRouteAndShowMap('route_nrw_anp')">
                    <div class="route-name">‡§®‡§∞‡§µ‡§æ‡§≤‡•Ä ‚Üí ‡§Ö‡§®‡•Ç‡§™‡§ó‡§¢‡§º (‡§µ‡§æ‡§™‡§∏‡•Ä)</div>
                    <div class="route-time" data-key="live_tracking_available">‡§≤‡§æ‡§á‡§µ ‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó ‡§â‡§™‡§≤‡§¨‡•ç‡§ß</div>
                </div>
            </div>
        </div>

        <!-- ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® 4: ‡§≤‡§æ‡§á‡§µ ‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó ‡§Æ‡•à‡§™ -->
        <div id="map-screen" class="screen">
            <div class="map-header">
                <span class="back-arrow" onclick="handleBackButton()">‚Üê</span>
                <h1 data-key="live_tracking_title">‡§≤‡§æ‡§á‡§µ ‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó</h1>
            </div>
            <div class="map-container">
                <div id="route-line"></div>
                <div class="stop" id="stop1"><span class="stop-label" data-key="anupgarh_stop">‡§Ö‡§®‡•Ç‡§™‡§ó‡§¢‡§º</span></div>
                <div class="stop" id="stop2"><span class="stop-label" data-key="ganesh_mandir_stop">‡§ó‡§£‡•á‡§∂ ‡§Æ‡§Ç‡§¶‡§ø‡§∞</span></div>
                <div class="stop" id="stop3"><span class="stop-label" data-key="bypass_stop">‡§¨‡§æ‡§à‡§™‡§æ‡§∏</span></div>
                <div class="stop" id="stop4"><span class="stop-label" data-key="head_34_stop">34 ‡§π‡•á‡§°</span></div>
                <div class="stop" id="stop5"><span class="stop-label" data-key="a11_stop">11A</span></div>
                <div class="stop" id="stop6"><span class="stop-label" data-key="lm4_stop">4LM</span></div>
                <div class="stop" id="stop7"><span class="stop-label" data-key="narwali_stop">‡§®‡§∞‡§µ‡§æ‡§≤‡•Ä</span></div>
                <div class="bus-icon">üöå</div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const API_BASE_URL = 'https://meri-bus-server.onrender.com/api';
            let trackingInterval = null, currentRouteId = null, currentScreenId = '';
            const screenHistory = [];
            const busIcon = document.querySelector('.bus-icon');
            
            const translations = {
                hi: {
                    welcome_title: 'Meri Bus ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à',
                    location_setup_title: '‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç', state: '‡§∞‡§æ‡§ú‡•ç‡§Ø', district: '‡§ú‡§º‡§ø‡§≤‡§æ', tehsil: '‡§§‡§π‡§∏‡•Ä‡§≤',
                    rajasthan_option: '‡§∞‡§æ‡§ú‡§∏‡•ç‡§•‡§æ‡§®', ganganagar_option: '‡§∂‡•ç‡§∞‡•Ä ‡§ó‡§Ç‡§ó‡§æ‡§®‡§ó‡§∞', anupgarh_option: '‡§Ö‡§®‡•Ç‡§™‡§ó‡§¢‡§º',
                    save_and_continue: '‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§Ü‡§ó‡•á ‡§¨‡§¢‡§º‡•á‡§Ç',
                    find_bus_title: '‡§¨‡§∏ ‡§ñ‡•ã‡§ú‡•á‡§Ç', from: '‡§ï‡§π‡§æ‡§Å ‡§∏‡•á', to: '‡§ï‡§π‡§æ‡§Å ‡§§‡§ï', from_placeholder: '‡§∂‡•Å‡§∞‡•Å‡§Ü‡§§‡•Ä ‡§∏‡•ç‡§ü‡•â‡§™', to_placeholder: '‡§ó‡§Ç‡§§‡§µ‡•ç‡§Ø ‡§∏‡•ç‡§ü‡•â‡§™',
                    find_buses_btn: '‡§¨‡§∏‡•á‡§Ç ‡§ñ‡•ã‡§ú‡•á‡§Ç', available_routes: '‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§∞‡•Ç‡§ü', live_tracking_available: '‡§≤‡§æ‡§á‡§µ ‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó ‡§â‡§™‡§≤‡§¨‡•ç‡§ß',
                    live_tracking_title: '‡§≤‡§æ‡§á‡§µ ‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó', anupgarh_stop: '‡§Ö‡§®‡•Ç‡§™‡§ó‡§¢‡§º', ganesh_mandir_stop: '‡§ó‡§£‡•á‡§∂ ‡§Æ‡§Ç‡§¶‡§ø‡§∞', bypass_stop: '‡§¨‡§æ‡§à‡§™‡§æ‡§∏', head_34_stop: '34 ‡§π‡•á‡§°', a11_stop: '11A', lm4_stop: '4LM', narwali_stop: '‡§®‡§∞‡§µ‡§æ‡§≤‡•Ä'
                },
                en: {
                    welcome_title: 'Welcome to Meri Bus',
                    location_setup_title: 'Select Region', state: 'State', district: 'District', tehsil: 'Tehsil',
                    rajasthan_option: 'Rajasthan', ganganagar_option: 'Sri Ganganagar', anupgarh_option: 'Anupgarh',
                    save_and_continue: 'Save and Continue',
                    find_bus_title: 'Find Bus', from: 'From', to: 'To', from_placeholder: 'Starting Stop', to_placeholder: 'Destination Stop',
                    find_buses_btn: 'Find Buses', available_routes: 'Available Routes', live_tracking_available: 'Live Tracking Available',
                    live_tracking_title: 'Live Tracking', anupgarh_stop: 'Anupgarh', ganesh_mandir_stop: 'Ganesh Mandir', bypass_stop: 'Bypass', head_34_stop: '34 Head', a11_stop: '11A', lm4_stop: '4LM', narwali_stop: 'Narwali'
                }
            };

            function setLanguage(lang) {
                document.querySelectorAll('[data-key]').forEach(el => {
                    const key = el.dataset.key;
                    if (translations[lang][key]) el.textContent = translations[lang][key];
                });
                document.querySelectorAll('[data-placeholder-key]').forEach(el => {
                    const key = el.dataset.placeholderKey;
                    if (translations[lang][key]) el.placeholder = translations[lang][key];
                });
                document.documentElement.lang = lang;
                localStorage.setItem('meriBusLanguage', lang);
                document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
                document.querySelector(`.lang-btn[data-lang="${lang}"]`).classList.add('active');
            }

            window.showScreen = function(screenId, isBack = false) {
                if (!isBack) {
                    const currentActiveScreen = document.querySelector('.screen.active');
                    if (currentActiveScreen) {
                        screenHistory.push(currentActiveScreen.id);
                    }
                }
                currentScreenId = screenId;
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById(screenId)?.classList.add('active');
                if (screenId !== 'map-screen') stopTracking();
            }

            window.handleBackButton = function() {
                if (screenHistory.length > 0) {
                    const previousScreenId = screenHistory.pop();
                    showScreen(previousScreenId, true);
                }
            }

            document.addEventListener("backbutton", (e) => {
                e.preventDefault();
                handleBackButton();
            }, false);

            window.selectRouteAndShowMap = function(routeId) {
                currentRouteId = routeId; 
                showScreen('map-screen'); 
                startTracking();
            }

            function startTracking() {
                stopTracking();
                fetchAndUpdateBusLocation();
                trackingInterval = setInterval(fetchAndUpdateBusLocation, 5000);
            }

            function stopTracking() {
                if (trackingInterval) clearInterval(trackingInterval);
                trackingInterval = null;
            }

            async function fetchAndUpdateBusLocation() {
                if (!currentRouteId) return;
                try {
                    const response = await fetch(`${API_BASE_URL}/track/location/${currentRouteId}`);
                    if (!response.ok) return;
                    const data = await response.json();
                    const coordinates = data.currentLocation.coordinates;
                    const startLat = 29.1907, endLat = 29.2500;
                    const progress = (coordinates[1] - startLat) / (endLat - startLat);
                    const topPosition = 12 + (progress * 76);
                    busIcon.style.top = `${Math.max(5, Math.min(95, topPosition))}%`;
                } catch (error) {
                    console.error("Error fetching location:", error);
                    stopTracking();
                }
            }

            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const lang = e.target.dataset.lang;
                    setLanguage(lang);
                    showScreen('location-setup-screen');
                });
            });
            
            document.getElementById('save-location-btn').addEventListener('click', () => {
                const userSetup = {
                    lang: localStorage.getItem('meriBusLanguage') || 'hi',
                    setupComplete: true
                };
                localStorage.setItem('meriBusUserSetup', JSON.stringify(userSetup));
                showScreen('search-screen');
            });
            
            document.getElementById('find-buses-btn').addEventListener('click', () => {
                showScreen('route-list-screen');
            });

            // ‡§ê‡§™ ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§ú‡§æ‡§Ç‡§ö
            const savedSetup = JSON.parse(localStorage.getItem('meriBusUserSetup'));
            if (savedSetup && savedSetup.setupComplete) {
                setLanguage(savedSetup.lang || 'hi');
                showScreen('search-screen');
            } else {
                setLanguage('hi');
                showScreen('language-screen');
            }
        });
    </script>
</body>
</html>
